---
import BaseLayout from './BaseLayout.astro';
import Nav from '../components/global/Nav.astro';
import Footer from '../components/global/Footer.astro';

interface Props {
  title: string;
  description?: string;
  id?: string;
  version?: string;
  date?: string;
  status?: string;
  type?: string;
}

const { title, description, id, version, date, status, type = 'Document' } = Astro.props;

// Map status to CSS class for the dot
const statusClass = status?.toLowerCase().replace(/\s+/g, '-') || 'planned';
---

<BaseLayout title={title} description={description}>
  <Nav slot="nav" />
  
  <article class="prose-page">
    <header class="prose-header">
      <div class="prose-meta-bar">
        <div class="prose-meta-row">
          {id && <span class="prose-meta-id">{id}</span>}
          <span class="prose-meta-type">{type}</span>
          {status && (
            <div class="prose-meta-status-group">
              <span class="prose-meta-status">{status}</span>
              <span class={`status-dot ${statusClass}`}></span>
            </div>
          )}
        </div>
        <div class="prose-meta-row">
          {version && <span class="prose-meta-version">v{version}</span>}
          {date && <span class="prose-meta-date">{date}</span>}
        </div>
      </div>
      <div class="prose-title-container">
        <h1 class="prose-title">{title}</h1>
      </div>
    </header>

    <div class="prose-content container container-narrow">
      <slot />
    </div>
  </article>

  <Footer slot="footer" />
</BaseLayout>

<style>
  .prose-page {
    padding-bottom: var(--space-2xl);
  }

  .prose-header {
    margin-bottom: var(--space-xl);
  }

  /* Meta bar - two-row layout like Methods/Dispatches */
  .prose-meta-bar {
    max-width: 800px;
    margin: 0 auto;
    padding: 3rem 2rem 1.5rem;
    border-bottom: 1px solid var(--faded-light);
  }

  .prose-meta-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .prose-meta-row + .prose-meta-row {
    margin-top: 0.25rem;
  }

  .prose-meta-id {
    font-family: var(--font-mono);
    font-size: 0.75rem;
    color: var(--gold);
  }

  .prose-meta-version {
    font-family: var(--font-mono);
    font-size: 0.7rem;
    color: var(--faded);
  }

  .prose-meta-type {
    font-family: var(--font-mono);
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--faded);
  }

  .prose-meta-status-group {
    display: flex;
    align-items: center;
    gap: 0.4rem;
  }

  .prose-meta-status {
    font-family: var(--font-mono);
    font-size: 0.65rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--faded);
  }

  .prose-meta-date {
    font-family: var(--font-mono);
    font-size: 0.7rem;
    text-transform: uppercase;
    color: var(--faded);
  }

  /* Status dot with pulse animation */
  :global(.status-dot) {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--faded);
    display: inline-block;
    flex-shrink: 0;
  }

  :global(.status-dot.living) {
    background: var(--success);
    animation: pulse 2s infinite;
  }

  :global(.status-dot.published) {
    background: var(--success);
    animation: pulse 2s infinite;
  }

  :global(.status-dot.draft) {
    background: var(--gold);
    animation: pulse 3s infinite;
  }

  :global(.status-dot.archived) {
    background: var(--faded-light);
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.4; }
  }

  /* Title section */
  .prose-title-container {
    max-width: 800px;
    margin: 0 auto;
    padding: var(--space-lg) 2rem;
  }

  .prose-title {
    font-family: var(--font-display);
    font-size: clamp(2rem, 5vw, 2.5rem);
    font-weight: 400;
    color: var(--ink);
    line-height: 1.2;
  }

  /* Content styles - using Lora for body text */
  .prose-content {
    font-family: var(--font-body);
    max-width: 800px;
    margin: 0 auto;
    padding: 0 2rem;
  }

  .prose-content :global(h2) {
    font-family: var(--font-display);
    font-size: 1.6rem;
    font-weight: 400;
    color: var(--ink);
    margin-top: 2.5rem;
    margin-bottom: var(--space-md);
  }

  .prose-content :global(h3) {
    font-family: var(--font-display);
    font-size: 1.35rem;
    font-weight: 500;
    color: var(--ink);
    margin-top: 2rem;
    margin-bottom: var(--space-sm);
  }

  .prose-content :global(p) {
    font-family: var(--font-body);
    font-size: 1.05rem;
    font-weight: 400;
    line-height: 1.8;
    color: var(--ink);
    margin-bottom: var(--space-md);
  }

  .prose-content :global(strong) {
    font-weight: 600;
  }

  .prose-content :global(em) {
    font-style: italic;
  }

  .prose-content :global(a) {
    color: var(--gold);
    text-decoration: underline;
    text-underline-offset: 2px;
  }

  .prose-content :global(a:hover) {
    color: var(--ink);
  }

  .prose-content :global(blockquote) {
    margin: var(--space-lg) 0;
    padding: var(--space-md) var(--space-lg);
    border-left: 3px solid var(--gold);
    background: var(--white);
    font-style: italic;
  }

  .prose-content :global(blockquote p) {
    margin-bottom: 0;
  }

  .prose-content :global(hr) {
    border: none;
    height: 1px;
    background: var(--faded-light);
    margin: var(--space-xl) 0;
  }

  .prose-content :global(ul),
  .prose-content :global(ol) {
    margin: var(--space-md) 0;
    padding-left: var(--space-lg);
  }

  .prose-content :global(ul) {
    list-style: disc;
  }

  .prose-content :global(ol) {
    list-style: decimal;
  }

  .prose-content :global(li) {
    font-family: var(--font-body);
    font-size: 1.05rem;
    font-weight: 400;
    margin-bottom: var(--space-sm);
    line-height: 1.8;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .prose-meta-bar {
      padding: 2rem 1rem 1rem;
    }
    
    .prose-title-container {
      padding: var(--space-md) 1rem;
    }
    
    .prose-content {
      padding: 0 1rem;
    }
  }
</style>

