---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import Nav from '../../components/global/Nav.astro';
import Footer from '../../components/global/Footer.astro';
import DispatchHeader from '../../components/dispatch/DispatchHeader.astro';
import AuthorBlock from '../../components/dispatch/AuthorBlock.astro';
import DispatchFooter from '../../components/dispatch/DispatchFooter.astro';
import SubscribeCTA from '../../components/dispatch/SubscribeCTA.astro';
import Table from '../../components/content/Table.astro';
import Figure from '../../components/content/Figure.astro';
import Callout from '../../components/content/Callout.astro';
import Caption from '../../components/content/Caption.astro';
import PullQuote from '../../components/content/PullQuote.astro';
import '../../styles/cartographic.css';

export async function getStaticPaths() {
  const dispatches = await getCollection('dispatches');
  return dispatches.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await entry.render();

// MDX components to pass
const components = { Table, Figure, Callout, Caption, PullQuote };
---

<BaseLayout 
  title={entry.data.title}
  description={entry.data.subtitle}
>
  <Nav slot="nav" />
  
  <article class="dispatch-article">
    <DispatchHeader
      id={entry.data.id}
      title={entry.data.title}
      subtitle={entry.data.subtitle}
      date={entry.data.date}
      readingTime={entry.data.reading_time}
      version={entry.data.version}
      status={entry.data.status}
    />

    <AuthorBlock 
      name={entry.data.author} 
    />

    <article class="dispatch-body">
      <div class="dispatch-content">
        <Content components={components} />
      </div>
    </article>

    <DispatchFooter
      dataSource={entry.data.data_source}
      references={entry.data.references}
      topics={entry.data.topics}
    />
    
    <SubscribeCTA />
  </article>

  <Footer slot="footer" />
</BaseLayout>

<style is:global>
  @import '../../styles/cartographic.css';
</style>


